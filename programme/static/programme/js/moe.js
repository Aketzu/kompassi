!function(a){"use strict";function b(a){var b=new XMLHttpRequest;return a.success=a.success||function(){},a.error=a.error||function(){},a.async=!0,b.open(a.method||"GET",a.url),b.send(a.data),b.onreadystatechange=function(){4===this.readyState&&200===this.status?a.success(this.responseText,this):4===this.readyState&&a.error(this.status,this.statusText,this)},b}var c=function(a,b){function c(a){n=a.document,o=a.location,q=a.cancelAnimationFrame||a.clearTimeout,p=a.requestAnimationFrame||a.setTimeout}function d(){var a,b=[].slice.call(arguments),c=!(null==b[1]||v.call(b[1])!==r||"tag"in b[1]||"subtree"in b[1]),d=c?b[1]:{},e="class"in d?"class":"className",f={tag:"div",attrs:{}},g=[];if(v.call(b[0])!=t)throw new Error("selector in m(selector, attrs, children) should be a string");for(;a=w.exec(b[0]);)if(""===a[1]&&a[2])f.tag=a[2];else if("#"===a[1])f.attrs.id=a[2];else if("."===a[1])g.push(a[2]);else if("["===a[3][0]){var h=x.exec(a[3]);f.attrs[h[1]]=h[3]||(h[2]?"":!0)}g.length>0&&(f.attrs[e]=g.join(" "));var i=c?b[2]:b[1];v.call(i)===s?f.children=i:f.children=c?b.slice(2):b.slice(1);for(var j in d)j===e?f.attrs[j]=(f.attrs[j]||"")+" "+d[j]:f.attrs[j]=d[j];return f}function e(a,c,d,h,i,j,k,l,m,o,p){if((null==i||null==i.toString())&&(i=""),"retain"===i.subtree)return j;var q=v.call(j),w=v.call(i);if(null==j||q!==w){if(null!=j)if(d&&d.nodes){var x=l-h,z=x+(w===s?i:j.nodes).length;g(d.nodes.slice(x,z),d.slice(x,z))}else j.nodes&&g(j.nodes,j);j=new i.constructor,j.tag&&(j={}),j.nodes=[]}if(w===s){for(var A=0,B=i.length;B>A;A++)v.call(i[A])===s&&(i=i.concat.apply([],i),A--);for(var C=[],D=j.length===i.length,E=0,F=1,G=2,H=3,I={},J=[],K=!1,A=0,B=j.length;B>A;A++)j[A]&&j[A].attrs&&null!=j[A].attrs.key&&(K=!0,I[j[A].attrs.key]={action:F,index:A});if(K){i.indexOf(null)>-1&&(i=i.filter(function(a){return null!=a}));for(var A=0,B=i.length;B>A;A++)if(i[A]&&i[A].attrs)if(null!=i[A].attrs.key){var L=i[A].attrs.key;I[L]?I[L]={action:H,index:A,from:I[L].index,element:a.childNodes[I[L].index]||n.createElement("div")}:I[L]={action:G,index:A}}else J.push({index:A,element:a.childNodes[A]||n.createElement("div")});for(var M,N=Object.keys(I).map(function(a){return I[a]}),O=N.sort(function(a,b){return a.action-b.action||a.index-b.index}),P=j.slice(),A=0;M=O[A];A++){if(M.action===F&&(g(j[M.index].nodes,j[M.index]),P.splice(M.index,1)),M.action===G){var Q=n.createElement("div");Q.key=i[M.index].attrs.key,a.insertBefore(Q,a.childNodes[M.index]||null),P.splice(M.index,0,{attrs:{key:i[M.index].attrs.key},nodes:[Q]})}M.action===H&&(a.childNodes[M.index]!==M.element&&null!==M.element&&a.insertBefore(M.element,a.childNodes[M.index]||null),P[M.index]=j[M.from])}for(var A=0,B=J.length;B>A;A++){var M=J[A];a.insertBefore(M.element,a.childNodes[M.index]||null),P[M.index]=j[M.index]}j=P,j.nodes=[];for(var R,A=0;R=a.childNodes[A];A++)j.nodes.push(R)}for(var A=0,S=0,B=i.length;B>A;A++){var T=e(a,c,j,l,i[A],j[S],k,l+E||E,m,o,p);T!==b&&(T.nodes.intact||(D=!1),E+=v.call(T)===s?T.length:1,j[S++]=T)}if(!D){for(var A=0,B=i.length;B>A;A++)null!=j[A]&&C.push.apply(C,j[A].nodes);for(var U,A=0;U=j.nodes[A];A++)null!=U.parentNode&&C.indexOf(U)<0&&g([U],[j[A]]);i.length<j.length&&(j.length=i.length),j.nodes=C}}else if(null!=i&&w===r){i.attrs||(i.attrs={}),j.attrs||(j.attrs={});var V=Object.keys(i.attrs);if((i.tag!=j.tag||V.join()!=Object.keys(j.attrs).join()||i.attrs.id!=j.attrs.id)&&(j.nodes.length&&g(j.nodes),j.configContext&&typeof j.configContext.onunload===u&&j.configContext.onunload()),v.call(i.tag)!=t)return;var U,W=0===j.nodes.length;if(W?(U=n.createElement(i.tag),j={tag:i.tag,attrs:V.length?f(U,i.tag,i.attrs,{},o):{},children:null!=i.children&&i.children.length>0?e(U,i.tag,b,b,i.children,j.children,!0,0,i.attrs.contenteditable?U:m,o,p):i.children,nodes:[U]},j.children&&!j.children.nodes&&(j.children.nodes=[]),"select"===i.tag&&i.attrs.value&&f(U,i.tag,{value:i.attrs.value},{},o),a.insertBefore(U,a.childNodes[l]||null)):(U=j.nodes[0],V.length&&f(U,i.tag,i.attrs,j.attrs,o),j.children=e(U,i.tag,b,b,i.children,j.children,!1,0,i.attrs.contenteditable?U:m,o,p),j.nodes.intact=!0,k===!0&&null!=U&&a.insertBefore(U,a.childNodes[l]||null)),typeof i.attrs.config===u){var X=j.configContext=j.configContext||{},Y=function(a,b){return function(){return a.attrs.config.apply(a,b)}};p.push(Y(i,[U,!W,X,j]))}}else if(typeof w!=u){var C;0===j.nodes.length?(C=[n.createTextNode(i)],a.nodeName.match(y)||a.insertBefore(C[0],a.childNodes[l]||null),j="string number boolean".indexOf(typeof i)>-1?new i.constructor(i):i,j.nodes=C):j.valueOf()!==i.valueOf()||k===!0?(C=j.nodes,m&&m===n.activeElement||("textarea"===c?a.value=i:m?m.innerHTML=i:((1===C[0].nodeType||C.length>1)&&(g(j.nodes,j),C=[n.createTextNode(i)]),a.insertBefore(C[0],a.childNodes[l]||null),C[0].nodeValue=i)),j=new i.constructor(i),j.nodes=C):j.nodes.intact=!0}return j}function f(a,b,c,d,e){for(var f in c){var g=c[f],h=d[f];if(f in d&&h===g)"value"===f&&"input"===b&&a.value!=g&&(a.value=g);else{d[f]=g;try{if("config"===f)continue;if(typeof g===u&&0===f.indexOf("on"))a[f]=i(g,a);else if("style"===f&&null!=g&&v.call(g)===r){for(var j in g)(null==h||h[j]!==g[j])&&(a.style[j]=g[j]);for(var j in h)j in g||(a.style[j]="")}else f in a&&"list"!==f&&"style"!==f&&"form"!==f&&"type"!==f?("input"!=f||a[f]!==g)&&(a[f]=g):a.setAttribute(f,g)}catch(k){if(k.message.indexOf("Invalid argument")<0)throw k}}}return d}function g(a,b){for(var c=a.length-1;c>-1;c--)if(a[c]&&a[c].parentNode){try{a[c].parentNode.removeChild(a[c])}catch(d){}b=[].concat(b),b[c]&&h(b[c])}0!=a.length&&(a.length=0)}function h(a){if(a.configContext&&typeof a.configContext.onunload===u&&a.configContext.onunload(),a.children)if(v.call(a.children)===s)for(var b,c=0;b=a.children[c];c++)h(b);else a.children.tag&&h(a.children)}function i(a,b){return function(c){c=c||event,d.redraw.strategy("diff"),d.startComputation();try{return a.call(b,c)}finally{L()}}}function j(a){var b=B.indexOf(a);return 0>b?B.push(a)-1:b}function k(a){var b=function(){return arguments.length&&(a=arguments[0]),a};return b.toJSON=function(){return a},b}function l(){for(var a,b="all"===d.redraw.strategy(),c=0;a=E[c];c++)G[c]&&d.render(a,F[c].view(G[c]),b);H=null,I=new Date,d.redraw.strategy("diff")}function m(a){var c=j(a);g(a.childNodes,C[c]),C[c]=b}var n,o,p,q,r="[object Object]",s="[object Array]",t="[object String]",u="function",v={}.toString,w=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,x=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,y=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/;c(a);var z,A={appendChild:function(a){z===b&&(z=n.createElement("html")),n.documentElement&&n.documentElement!==a?n.replaceChild(a,n.documentElement):n.appendChild(a),this.childNodes=n.childNodes},insertBefore:function(a){this.appendChild(a)},childNodes:[]},B=[],C={};d.render=function(a,c,d){var f=[];if(!a)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var h=j(a),i=a===n,k=i||a===n.documentElement?A:a;i&&"html"!=c.tag&&(c={tag:"html",attrs:{},children:c}),C[h]===b&&g(k.childNodes),d===!0&&m(a),C[h]=e(k,null,b,b,c,C[h],!1,0,null,b,f);for(var l=0,o=f.length;o>l;l++)f[l]()},d.prop=function(a){return k(a)};var D,E=[],F=[],G=[],H=null,I=0,J=16;d.module=function(a,b){var c=E.indexOf(a);0>c&&(c=E.length);var e=!1;if(G[c]&&typeof G[c].onunload===u){var f={preventDefault:function(){e=!0}};G[c].onunload(f)}if(!e){d.redraw.strategy("all"),d.startComputation(),E[c]=a;var g=D=b,h=new b.controller;return g===D&&(G[c]=h,F[c]=b),L(),G[c]}},d.redraw=function(b){H&&b!==!0?(new Date-I>J||p===a.requestAnimationFrame)&&(H>0&&q(H),H=p(l,J)):(l(),H=p(function(){H=null},J))},d.redraw.strategy=d.prop();var K=0;d.startComputation=function(){K++},d.endComputation=function(){K=Math.max(K-1,0),0===K&&d.redraw()};var L=function(){"none"==d.redraw.strategy()?(K--,d.redraw.strategy("diff")):d.endComputation()};return d.withAttr=function(a,b){return function(c){c=c||event;var d=c.currentTarget||this;b(a in d?d[a]:d.getAttribute(a))}},d}("undefined"!=typeof a?a:{}),d={};d.pluck=function(a,b){return a.map(function(a){return a[b]})},d.uniq=function(a){var b={},c=[];return a.forEach(function(a){b[a]||(b[a]=1,c.push(a))}),c},d.escapeRegExp=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},d.cmp=function(a,b){return b>a?-1:a>b?1:0};var e={5:"perjantai",6:"lauantai",0:"sunnuntai"};d.formatTime=function(a){var b=""+a.getMinutes();1===b.length&&(b="0"+b);var c=""+a.getHours();return 1===c.length&&(c="0"+c),c+":"+b},d.getWeekday=function(a){return e[a.getDay()]||"päiväntäi"},function(){function e(a){return a._cached||(a.start_ts=Date.parse(a.start_time),a.end_ts=Date.parse(a.end_time),a.start=new Date(a.start_ts),a.end=new Date(a.end_ts),a.weekday=d.getWeekday(a.start),a.startTimeStr=d.formatTime(a.start),a.endTimeStr=d.formatTime(a.end),a._cached=!0),a}function f(a){return a.forEach(e),a.sort(function(a,b){return d.cmp(a.start_time,b.start_time)||d.cmp(a.location,b.location)})}function g(){var a,d=+new Date/1e3;if(a=s.get("data")){var e=0|s.get("dataMtime"),g=d-e;if(900>g)return a=f(a),u(a),c.redraw(),u}return b({method:"GET",url:r.schedule_url,success:function(a){a=JSON.parse(a),a=f(a),s.set("data",a),s.set("dataMtime",d),u(a),c.redraw()}}),u}function h(){u().length||g(),t.load(),setInterval(function(){c.redraw()},6e4)}function i(a){var b=(a||"").split(/\s+/).filter(function(a){return a.length>0}).map(function(a){return new RegExp(d.escapeRegExp(a),"i")});return b.length?function(a){for(var c=0;c<b.length;c++)if(!b[c].test(a))return!1;return!0}:null}function j(){var a=+new Date,b=i(w()),c=!!v(),d=x(),e=y(),f=d&&"-"!==d?d:null,g=e&&"-"!==e?e:null;return function(d){return!c&&a>d.end_ts?!1:!b||b(d.title)||b(d.presenter)?f&&d.location!=f?!1:g&&d.kind_display!=g?!1:!0:!1}}function k(a,b,e){var f=d.uniq(d.pluck(u(),b));return c("select.filter",{onchange:c.withAttr("value",e),value:e},[c("option",{value:"-"},a)].concat(f.map(function(a){return c("option",{value:a},a)})))}function l(a){t.set(a.target.id.replace(/^star-/,""),!!a.target.checked)}function m(a){return"Puuseppä"===a?"Puu­seppä":"Metsähalli"===a?"Metsä­halli":a}function n(a){z(z()===a?null:a)}function o(a){var b=[],d=null;return a.forEach(function(a){a.weekday!==d&&(d=a.weekday,b.push(c("tr.weekday-divider",[c("td[colspan=4])",a.weekday)]))),b.push(c("tr",{className:"prog "+a.klass},[c("td.times",[a.startTimeStr+" – "+a.endTimeStr]),c("td",[c("div.title",c("a",{href:"#p-"+a.identifier,onclick:function(b){return n(a.identifier),b.stopPropagation(),!1}},a.title)),c("div.meta",[a.kind_display?c("span.kind."+a.kind,a.kind_display):null,a.presenter?c("span.pres",a.presenter):null,a.hashtag?c("span.hashtag","#"+a.hashtag):null])]),c("td.loc",[m(a.location)]),c("td.star",c("label",[c("input.star-cb[type=checkbox]",{checked:t.get(a),id:"star-"+a.identifier,onchange:l}),"★"]))])),z()===a.identifier&&b.push(c("tr",[c("td",{colspan:4},c("div.description",a.description.replace(/<.+?>/g," ")))]))}),b}function p(){var a=u().filter(j()),b=+new Date;return a.forEach(function(a){var c="";a.start_ts<=b&&b<=a.end_ts?c="current":b>a.end_ts&&(c="past"),a.klass=c+(t.get(a)?" starred":"")}),s.set("search",w()),s.set("showPast",v()),c("div",[c("div#controls",[c("label",[c("input#search[placeholder=Etsi nimestä ja esittäjästä...]",{onchange:c.withAttr("value",w),oninput:c.withAttr("value",w),value:w()})]),c("label",[k("Sijainti...","location",x)]),c("label",[k("Laji...","kind_display",y)]),c("label",[c("input[type=checkbox]",{checked:v(),onchange:c.withAttr("checked",v)}),"Menneet myös"])]),c("div#wrap",[a.length?c("table",{id:"schedule"},o(a)):c("div.no-results","Ei tuloksia :(")])])}var q="20141222",r=a.C,s=function(b){var c=a.localStorage&&a.JSON?a.localStorage:null,d="moe_"+q+"_"+b.event_slug+"_";return{get:function(a){var b=c?c[d+a]:null;try{return null!==b?JSON.parse(b):null}catch(e){return null}},set:function(a,b){c&&(c[d+a]=JSON.stringify(b))}}}(r),t=function(){function a(){b({method:"GET",url:r.starred_url,success:function(a){a=JSON.parse(a),a.starred.forEach(function(a){f[a]=!0}),c.redraw()}})}function d(a){var b=g()[a.identifier];return b===!0||b===!1?!!b:!!f[a.identifier]}function e(a,c){var d=g();d[a]=!!c,g(d),s.set("starred",d),r.logged_in&&b({method:"POST",url:(c?r.star_url:r.unstar_url)+"?event="+r.event_slug+"&program_id="+a,data:"true"})}var f={},g=c.prop(s.get("starred")||{});return{load:a,get:d,set:e}}(),u=c.prop([]),v=c.prop(!!s.get("showPast")),w=c.prop(s.get("search")||""),x=c.prop("-"),y=c.prop("-"),z=c.prop(null);a.addEventListener("load",function(){c.module(a.document.body,{controller:h,view:p})},!1)}()}(window);